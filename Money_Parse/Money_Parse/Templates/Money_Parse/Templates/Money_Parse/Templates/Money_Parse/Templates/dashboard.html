{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/Defaults.css' %}?v=1.1">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}?v=1.1">
    <script>
        function confirmDelete() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                window.location.href = "{% url 'delete_account' %}";
            }
        }
    </script>
</head>
<body>
<button onclick="confirmDelete()" class="card-da-btn">
    Delete Account
</button>
<button onclick="window.location.href='{% url 'accounts.logout' %}'" class="card-lo-btn">
          Logout
</button>
<div class="dashboard-container">
    <div class="top-section">
        <div class="card transactions-card">
            <div class="card-header">
                <h2>Transactions</h2>
                <a href="{% url 'exp-transactions' %}" class="sandwich-btn" title="View all transactions">
                  <span class="line"></span>
                  <span class="line"></span>
                  <span class="line"></span>
                </a>
            </div>
    
            
            <!-- Logic fro adding transactions -->
            <form method = "post" action = "/add-transaction/" >
                <!-- dropdown menu for category - default text "Category -->
                {% csrf_token %}
                <select name="category" id="category"  class = "forms_container" required >
                    <option value="" disabled selected hidden >Category</option>
                    {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
                <!-- text box for name - default text "Exspense" -->
                <input type = "text" id = "name" name ="name" placeholder="Expense" class = "forms_container" required>
                <!-- (numerical) text box for amount - default text "Amount" -->
                <input type = "number" id = "amount" name = "amount" step = "0.01" min = "0" placeholder= "Amount" class = "forms_container" required>
                <button type = "submit" class = "forms_container-submit" style="color: #0A7A26;"> Add Transaction </button>
            </form>


            <table>
                <thead>
                    <tr><th>Category</th><th>Expense</th><th>Amount</th><th>Date</th></tr>
                </thead>
                <tbody>
                {% for t in transactions|slice:":7" %} <!-- print only the first 7 -->
                    <tr>
                        <td>{{ t.category.name }}</td>
                        <td>{{ t.name }}</td>
                        <td>${{ t.amount }}</td>
                        <td>{{ t.date }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="card budget-card">
    <div class="card-header">
        <h2>Monthly Budget</h2>
        <a href="{% url 'budget' %}"
           class="sandwich-btn"
           title="View full budget">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </a>
    </div>

    {% for cat in category_data %}
        <div class="progress-row">
            <div class="label">
                {{ cat.name }}: ${{ cat.spent }} / ${{ cat.budget }}
            </div>
            <div class="progress-bar">
                <div
                    class="progress-fill {% if cat.percent > 100 %}over-budget {% elif cat.percent > 80 %}veryclose-budget{% elif cat.percent > 60 %}close-budget{% endif %}"
                    style="width: {% if cat.percent > 100 %}100{% else %}{{ cat.percent }}{% endif %}%;">
                </div>
            </div>
        </div>
    {% endfor %}
    </div>

    <div class="card tips-card">
        <h2>Quick tips</h2>
        <ul>
            {% if financial_advice %}
                {% for tip in financial_advice %}
                    <li>
                        <span class="dot">*</span> {{ tip }}
                        <span class="info-icon">i</span>
                    </li>
                {% endfor %}
            {% else %}
                <li>No financial tips available at the moment.</li>
            {% endif %}
        </ul>
    </div>
</div>
</body>
</html>
