{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Fonts and Styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/about.css' %}?v=1.2">
  <link rel="stylesheet" href="{% static 'css/Defaults.css' %}?v=1.2">
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}?v=1">
  <style>
  /* Card styling */
  .transactions-card {
    background: rgba(255, 255, 255, 0.8); /* almost solid white */
    border: 1px solid #E0E0E0;             /* light grey border */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    position: relative;
  }
  /* Back button */
  .card-back-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background-color: #0B8C2C; /* dark green */
    color: #FFFFFF;
    border: none;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
  }
  /* Header title color */
  .transactions-header h2 {
    color: #0B8C2C;
  }
  /* Controls container entirely white pills */
  .transactions-controls .date-range,
  .transactions-controls .search-input,
  .transactions-controls .forms_container {
    background: #FFFFFF;
    border: 1px solid #E0E0E0;
    border-radius: 20px;
    padding: 0.4rem 0.8rem;
  }
  .transactions-controls .date-range input.date-input {
    background: #FFFFFF;
    border: none;
    border-radius: 20px;
    padding: 0.4rem 0.8rem;
      height: 5px;
  }
  .transactions-controls .search-input {
    width: 200px;
    background: #FFFFFF;
    border: 1px solid #E0E0E0;
    border-radius: 20px;
    height: 35px;
    padding: 0 0.75rem;
  }
  .transactions-controls .small-select {
    background: #FFFFFF;
    border: 1px solid #E0E0E0;
    border-radius: 20px;
    height: 35px;
    padding: 0 0.75rem;
  }
  /* Table styling */
  .transactions-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: transparent;
  }
  .transactions-table th,
  .transactions-table td {
    padding: 0.75rem 1rem;
    color: #090909;
  }
  .transactions-table thead tr {
    background: #F7F7F7;
  }
  .transactions-table tbody tr {
    background: #FFFFFF;
    margin-bottom: 1rem;
  }
  .transactions-table tbody tr + tr td {
    border-top: 1px solid #E0E0E0;
  }
  /* Handle dots color */
  .handle {
    color: #A9A9A9;
  }
</style>
  <title>Transactions</title>
</head>
<body>
  <!-- Transactions List -->
  <section class="dashboard-container">
    <div class="top-section">
      <div class="card transactions-card">
        <!-- Back button in top-right -->
        <button onclick="window.location.href='{% url 'dashboard' %}'" class="card-back-btn">
          &larr; Dashboard
        </button>

        <!-- Header -->
        <form method="get" action="{% url 'exp-transactions' %}">
          <div class="transactions-controls" style="display: flex; align-items: center; gap: 0.5rem;">

            <div class="date-range" style="display: flex; align-items: center; gap: 0.25rem;">
              <input type="date" name="start_date" value="{{ request.GET.start_date }}" class="date-input">
              <span>to</span>
              <input type="date" name="end_date" value="{{ request.GET.end_date }}" class="date-input">
            </div>

            <input type="text" name="q" placeholder="Search" value="{{ request.GET.q }}" class="search-input">

            <select name="alpha_order" class="forms_container small-select">
              <option value="asc" {% if request.GET.alpha_order == "asc" %}selected{% endif %}>A–Z</option>
              <option value="desc" {% if request.GET.alpha_order == "desc" %}selected{% endif %}>Z–A</option>
            </select>

            <select name="sort_by" class="forms_container small-select">
              <option value="date" {% if request.GET.sort_by == "date" %}selected{% endif %}>Sort By Date</option>
              <option value="amount" {% if request.GET.sort_by == "amount" %}selected{% endif %}>Sort By Amount</option>
            </select>

            <button type="submit">Apply Filters</button>

          </div>
        </form>

        <!-- Table -->
        <div class="table-wrapper">
          <table class="transactions-table">
            <thead>
              <tr>
                <th></th>
                <th>Category</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {% for txn in transactions %}
              <tr>
                <td class="handle">⋮⋮⋮</td>
                <td>{{ txn.category.name }}</td>
                <td>{{ txn.name }}</td>
                <td>${{ txn.amount }}</td>
                <td>{{ txn.date|date:"n/j/y" }}</td>
                <td>
                  <!-- EDIT LINK (this is fine) -->
                  {# EDIT BUTTON #}
                  <form
                    action="{% url 'edit_transaction' txn.id %}"
                    method="get"
                    style="display:inline"
                  >
                    <button
                      type="submit"
                      class="btn btn-link p-0 m-0 align-baseline"
                    >
                      Edit
                    </button>
                  </form>
                  <!-- ADD THIS: opening form tag! -->
                  <form
                    action="{% url 'delete_transaction' txn.id %}"
                    method="post"
                    style="display:inline"
                    onsubmit="return confirm('Are you sure you want to delete this transaction?');"
                  >
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0 m-0 align-baseline">
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</body>
</html>
